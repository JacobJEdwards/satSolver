<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns, CPP, GADTs, FlexibleContexts, ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module    : System.Random.MWC.Distributions</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright : (c) 2012 Bryan O'Sullivan</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License   : BSD3</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Maintainer  : bos@serpentine.com</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Portability : portable</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Pseudo-random number generation for non-uniform distributions.</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Random.MWC.Distributions</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Variates: non-uniformly distributed values</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Continuous distributions</span></span><span>
</span><span id="line-18"></span><span>      </span><span class="annot"><a href="System.Random.MWC.Distributions.html#normal"><span class="hs-identifier">normal</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#standard"><span class="hs-identifier">standard</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#exponential"><span class="hs-identifier">exponential</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#truncatedExp"><span class="hs-identifier">truncatedExp</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier">gamma</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#chiSquare"><span class="hs-identifier">chiSquare</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#beta"><span class="hs-identifier">beta</span></a></span><span>
</span><span id="line-25"></span><span>      </span><span class="annot"><span class="hs-comment">-- ** Discrete distribution</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#categorical"><span class="hs-identifier">categorical</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#logCategorical"><span class="hs-identifier">logCategorical</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#geometric0"><span class="hs-identifier">geometric0</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#geometric1"><span class="hs-identifier">geometric1</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#bernoulli"><span class="hs-identifier">bernoulli</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#binomial"><span class="hs-identifier">binomial</span></a></span><span>
</span><span id="line-32"></span><span>      </span><span class="annot"><span class="hs-comment">-- ** Multivariate</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#dirichlet"><span class="hs-identifier">dirichlet</span></a></span><span>
</span><span id="line-34"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Permutations</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformPermutation"><span class="hs-identifier">uniformPermutation</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformShuffle"><span class="hs-identifier">uniformShuffle</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformShuffleM"><span class="hs-identifier">uniformShuffleM</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- * References</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- $references</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapM</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftM</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Primitive</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrimMonad</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PrimState</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_base(4,8,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Traversable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Traversable</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Traversable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapM</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random.Stateful</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StatefulGen</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">Uniform</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">UniformRange</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">uniformDoublePositive01M</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Generic</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Generic.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.SpecFunctions</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">logFactorial</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Unboxed 2-tuple</span><span>
</span><span id="line-59"></span><span class="hs-keyword">data</span><span> </span><span id="T"><span class="annot"><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-var">T</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="T"><span class="annot"><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-var">T</span></a></span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- | Generate a normally distributed random variate with given mean</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- and standard deviation.</span><span>
</span><span id="line-64"></span><span id="local-6989586621679067046"><span id="local-6989586621679067047"><span class="annot"><a href="System.Random.MWC.Distributions.html#normal"><span class="hs-identifier hs-type">normal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067046"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067047"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-65"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Mean</span></span><span>
</span><span id="line-66"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Standard deviation</span></span><span>
</span><span id="line-67"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067046"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-68"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067047"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-69"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#normal"><span class="hs-pragma hs-type">normal</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-70"></span><span id="normal"><span class="annot"><span class="annottext">normal :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#normal"><span class="hs-identifier hs-var hs-var">normal</span></a></span></span><span> </span><span id="local-6989586621679067311"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067311"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679067312"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067312"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679067313"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067313"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679067314"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067314"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#standard"><span class="hs-identifier hs-var">standard</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067313"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067311"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067312"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067314"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Generate a normally distributed random variate with zero mean and</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- unit variance.</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- The implementation uses Doornik's modified ziggurat algorithm.</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- Compared to the ziggurat algorithm usually used, this is slower,</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- but generates more independent variates that pass stringent tests</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- of randomness.</span><span>
</span><span id="line-81"></span><span id="local-6989586621679067053"><span id="local-6989586621679067054"><span class="annot"><a href="System.Random.MWC.Distributions.html#standard"><span class="hs-identifier hs-type">standard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067053"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067054"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067053"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067054"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-82"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#standard"><span class="hs-pragma hs-type">standard</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-83"></span><span id="standard"><span class="annot"><span class="annottext">standard :: forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#standard"><span class="hs-identifier hs-var hs-var">standard</span></a></span></span><span> </span><span id="local-6989586621679067391"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Double
</span><a href="#local-6989586621679067392"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621679067392"><span class="annot"><span class="annottext">loop :: m Double
</span><a href="#local-6989586621679067392"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>      </span><span id="local-6989586621679067393"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">u</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; m Double -&gt; m Double
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621679067396"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679067396"><span class="hs-identifier hs-var">ri</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Word32
forall a g (m :: * -&gt; *). (Uniform a, StatefulGen g m) =&gt; g -&gt; m a
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Word32
</span><span class="hs-identifier hs-var">uniformM</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067398"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679067398"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679067396"><span class="hs-identifier hs-var">ri</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">127</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>          </span><span id="local-6989586621679067399"><span class="annot"><span class="annottext">bi :: Double
</span><a href="#local-6989586621679067399"><span class="hs-identifier hs-var hs-var">bi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Int -&gt; Double
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">I.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067398"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-90"></span><span>          </span><span id="local-6989586621679067402"><span class="annot"><span class="annottext">bj :: Double
</span><a href="#local-6989586621679067402"><span class="hs-identifier hs-var hs-var">bj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Int -&gt; Double
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">I.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067398"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Int -&gt; Double
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">I.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="System.Random.MWC.Distributions.html#ratios"><span class="hs-identifier hs-var">ratios</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067398"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067399"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-93"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067398"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Double
</span><a href="#local-6989586621679067406"><span class="hs-identifier hs-var">normalTail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067407"><span class="annot"><span class="annottext">x :: Double
</span><a href="#local-6989586621679067407"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067393"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067399"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-96"></span><span>                 </span><span id="local-6989586621679067408"><span class="annot"><span class="annottext">xx :: Double
</span><a href="#local-6989586621679067408"><span class="hs-identifier hs-var hs-var">xx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067407"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067407"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-97"></span><span>                 </span><span id="local-6989586621679067409"><span class="annot"><span class="annottext">d :: Double
</span><a href="#local-6989586621679067409"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067399"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067399"><span class="hs-identifier hs-var">bi</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067408"><span class="hs-identifier hs-var">xx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                 </span><span id="local-6989586621679067411"><span class="annot"><span class="annottext">e :: Double
</span><a href="#local-6989586621679067411"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067402"><span class="hs-identifier hs-var">bj</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067402"><span class="hs-identifier hs-var">bj</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067408"><span class="hs-identifier hs-var">xx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>             </span><span id="local-6989586621679067412"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067412"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-100"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067411"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067412"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067409"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067411"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-101"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067407"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-102"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m Double
</span><a href="#local-6989586621679067392"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679067406"><span class="annot"><span class="annottext">normalTail :: Bool -&gt; m Double
</span><a href="#local-6989586621679067406"><span class="hs-identifier hs-var hs-var">normalTail</span></a></span></span><span> </span><span id="local-6989586621679067413"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679067413"><span class="hs-identifier hs-var">neg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Double
</span><a href="#local-6989586621679067414"><span class="hs-identifier hs-var">tailing</span></a></span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679067414"><span class="annot"><span class="annottext">tailing :: m Double
</span><a href="#local-6989586621679067414"><span class="hs-identifier hs-var hs-var">tailing</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>              </span><span id="local-6989586621679067415"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067415"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; m Double -&gt; m Double
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-106"></span><span>              </span><span id="local-6989586621679067419"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067419"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span>              </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; m Double -&gt; m Double
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067391"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-107"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067419"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067415"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067415"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-108"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Double
</span><a href="#local-6989586621679067414"><span class="hs-identifier hs-var">tailing</span></a></span><span>
</span><span id="line-109"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679067413"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067415"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067415"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- Constants used by standard/normal. They are floated to the top</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- level to avoid performance regression (Bug #16) when blocks/ratios</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- are recalculated on each call to standard/normal. It's also</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- somewhat difficult to trigger reliably.</span><span>
</span><span id="line-115"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-identifier hs-type">blocks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">I.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-116"></span><span id="blocks"><span class="annot"><span class="annottext">blocks :: Vector Double
</span><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-identifier hs-var hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; Double -&gt; Vector Double
forall a. Unbox a =&gt; Vector a -&gt; a -&gt; Vector a
</span><span class="hs-operator hs-var">`I.snoc`</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; (T -&gt; Vector Double) -&gt; T -&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Vector Double -&gt; Vector Double
forall a. Unbox a =&gt; a -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">I.cons</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067422"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067423"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; (T -&gt; Vector Double) -&gt; T -&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Vector Double -&gt; Vector Double
forall a. Unbox a =&gt; a -&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">I.cons</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; (T -&gt; Vector Double) -&gt; T -&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (T -&gt; Maybe (Double, T)) -&gt; T -&gt; Vector Double
forall a b. Unbox a =&gt; Int -&gt; (b -&gt; Maybe (a, b)) -&gt; b -&gt; Vector a
</span><span class="hs-identifier hs-var">I.unfoldrN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">126</span></span><span> </span><span class="annot"><span class="annottext">T -&gt; Maybe (Double, T)
</span><a href="#local-6989586621679067425"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(T -&gt; Vector Double) -&gt; T -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; T
</span><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-var">T</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067423"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679067425"><span class="annot"><span class="annottext">go :: T -&gt; Maybe (Double, T)
</span><a href="#local-6989586621679067425"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-type">T</span></a></span><span> </span><span id="local-6989586621679067426"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067426"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679067427"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067427"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679067428"><span class="annot"><span class="annottext">u :: T
</span><a href="#local-6989586621679067428"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; T
</span><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-var">T</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067429"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067429"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067429"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>                     </span><span id="local-6989586621679067429"><span class="annot"><span class="annottext">h :: Double
</span><a href="#local-6989586621679067429"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067422"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067426"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067427"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Double, T) -&gt; Maybe (Double, T)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067429"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">T
</span><a href="#local-6989586621679067428"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679067422"><span class="annot"><span class="annottext">v :: Double
</span><a href="#local-6989586621679067422"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">9.91256303526217e-3</span></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679067423"><span class="annot"><span class="annottext">f :: Double
</span><a href="#local-6989586621679067423"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var">rNorm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-pragma hs-type">blocks</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-type">rNorm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-126"></span><span id="rNorm"><span class="annot"><span class="annottext">rNorm :: Double
</span><a href="System.Random.MWC.Distributions.html#rNorm"><span class="hs-identifier hs-var hs-var">rNorm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3.442619855899</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#ratios"><span class="hs-identifier hs-type">ratios</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">I.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-129"></span><span id="ratios"><span class="annot"><span class="annottext">ratios :: Vector Double
</span><a href="System.Random.MWC.Distributions.html#ratios"><span class="hs-identifier hs-var hs-var">ratios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double)
-&gt; Vector Double -&gt; Vector Double -&gt; Vector Double
forall a b c.
(Unbox a, Unbox b, Unbox c) =&gt;
(a -&gt; b -&gt; c) -&gt; Vector a -&gt; Vector b -&gt; Vector c
</span><span class="hs-identifier hs-var">I.zipWith</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(/)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Unbox a =&gt; Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">I.tail</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="System.Random.MWC.Distributions.html#blocks"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-130"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#ratios"><span class="hs-pragma hs-type">ratios</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><span class="hs-comment">-- | Generate an exponentially distributed random variate.</span></span><span>
</span><span id="line-135"></span><span id="local-6989586621679067093"><span id="local-6989586621679067094"><span class="annot"><a href="System.Random.MWC.Distributions.html#exponential"><span class="hs-identifier hs-type">exponential</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067093"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067094"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Scale parameter</span></span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067093"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067094"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-139"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#exponential"><span class="hs-pragma hs-type">exponential</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-140"></span><span id="exponential"><span class="annot"><span class="annottext">exponential :: forall g (m :: * -&gt; *). StatefulGen g m =&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#exponential"><span class="hs-identifier hs-var hs-var">exponential</span></a></span></span><span> </span><span id="local-6989586621679067448"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067448"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679067449"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067449"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621679067450"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067450"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067449"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-glyph">-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067450"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067448"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">-- | Generate truncated exponentially distributed random variate.</span></span><span>
</span><span id="line-146"></span><span id="local-6989586621679067097"><span id="local-6989586621679067098"><span class="annot"><a href="System.Random.MWC.Distributions.html#truncatedExp"><span class="hs-identifier hs-type">truncatedExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067097"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067098"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-147"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Scale parameter</span></span><span>
</span><span id="line-148"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ Range to which distribution is</span><span>
</span><span id="line-149"></span><span>                                  </span><span class="hs-comment">--   truncated. Values may be negative.</span><span>
</span><span id="line-150"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067097"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator.</span></span><span>
</span><span id="line-151"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067098"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-152"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#truncatedExp"><span class="hs-pragma hs-type">truncatedExp</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-153"></span><span id="truncatedExp"><span class="annot"><span class="annottext">truncatedExp :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; (Double, Double) -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#truncatedExp"><span class="hs-identifier hs-var hs-var">truncatedExp</span></a></span></span><span> </span><span id="local-6989586621679067467"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067467"><span class="hs-identifier hs-var">scale</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067468"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067468"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679067469"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067469"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679067470"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067470"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-comment">-- We shift a to 0 and then generate distribution truncated to [0,b-a]</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-comment">-- It's easier</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067471"><span class="annot"><span class="annottext">delta :: Double
</span><a href="#local-6989586621679067471"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067469"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067468"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621679067472"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067472"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067470"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067468"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067472"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067472"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067467"><span class="hs-identifier hs-var">scale</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067471"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067467"><span class="hs-identifier hs-var">scale</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><span class="hs-comment">-- | Random variate generator for gamma distribution.</span></span><span>
</span><span id="line-161"></span><span id="local-6989586621679067473"><span id="local-6989586621679067474"><span class="annot"><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier hs-type">gamma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067473"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067474"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Shape parameter</span></span><span>
</span><span id="line-163"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Scale parameter</span></span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067473"><span class="hs-identifier hs-type">g</span></a></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-166"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-pragma hs-type">gamma</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-167"></span><span id="gamma"><span class="annot"><span class="annottext">gamma :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier hs-var hs-var">gamma</span></a></span></span><span> </span><span id="local-6989586621679067534"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679067535"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067535"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679067536"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067536"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Double
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;gamma&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;negative alpha parameter&quot;</span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Double
</span><a href="#local-6989586621679067539"><span class="hs-identifier hs-var">mainloop</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>      </span><span id="local-6989586621679067539"><span class="annot"><span class="annottext">mainloop :: m Double
</span><a href="#local-6989586621679067539"><span class="hs-identifier hs-var hs-var">mainloop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-type">T</span></a></span><span> </span><span id="local-6989586621679067540"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067540"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679067541"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067541"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m T
</span><a href="#local-6989586621679067542"><span class="hs-identifier hs-var">innerloop</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span id="local-6989586621679067543"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067543"><span class="hs-identifier hs-var">u</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067536"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067544"><span class="annot"><span class="annottext">cont :: Bool
</span><a href="#local-6989586621679067544"><span class="hs-identifier hs-var hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067543"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.331</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="System.Random.MWC.Distributions.html#sqr"><span class="hs-identifier hs-var">sqr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="System.Random.MWC.Distributions.html#sqr"><span class="hs-identifier hs-var">sqr</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067540"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067543"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
</span><a href="System.Random.MWC.Distributions.html#sqr"><span class="hs-identifier hs-var">sqr</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067540"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067548"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067541"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067541"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Rarely evaluated</span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>          </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679067544"><span class="hs-identifier hs-var">cont</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Double
</span><a href="#local-6989586621679067539"><span class="hs-identifier hs-var">mainloop</span></a></span><span>
</span><span id="line-178"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067548"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067541"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067535"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-179"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679067549"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067549"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067536"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-180"></span><span>                             </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067549"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">**</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067548"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067541"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067535"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-comment">-- inner loop</span><span>
</span><span id="line-182"></span><span>      </span><span id="local-6989586621679067542"><span class="annot"><span class="annottext">innerloop :: m T
</span><a href="#local-6989586621679067542"><span class="hs-identifier hs-var hs-var">innerloop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>        </span><span id="local-6989586621679067551"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067551"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#standard"><span class="hs-identifier hs-var">standard</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067536"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067552"><span class="hs-identifier hs-var">a2</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067551"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>          </span><span id="local-6989586621679067553"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067553"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067553"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m T
</span><a href="#local-6989586621679067542"><span class="hs-identifier hs-var">innerloop</span></a></span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">T -&gt; m T
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(T -&gt; m T) -&gt; T -&gt; m T
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; T
</span><a href="System.Random.MWC.Distributions.html#T"><span class="hs-identifier hs-var">T</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067551"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067553"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067553"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067553"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-comment">-- constants</span><span>
</span><span id="line-188"></span><span>      </span><span id="local-6989586621679067554"><span class="annot"><span class="annottext">a' :: Double
</span><a href="#local-6989586621679067554"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span id="local-6989586621679067548"><span class="annot"><span class="annottext">a1 :: Double
</span><a href="#local-6989586621679067548"><span class="hs-identifier hs-var hs-var">a1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067554"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">3</span></span><span>
</span><span id="line-190"></span><span>      </span><span id="local-6989586621679067552"><span class="annot"><span class="annottext">a2 :: Double
</span><a href="#local-6989586621679067552"><span class="hs-identifier hs-var hs-var">a2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">9</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067548"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><span class="hs-comment">-- | Random variate generator for the chi square distribution.</span></span><span>
</span><span id="line-194"></span><span id="local-6989586621679067104"><span id="local-6989586621679067105"><span class="annot"><a href="System.Random.MWC.Distributions.html#chiSquare"><span class="hs-identifier hs-type">chiSquare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067104"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067105"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                </span><span class="annot"><span class="hs-comment">-- ^ Number of degrees of freedom</span></span><span>
</span><span id="line-196"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067104"><span class="hs-identifier hs-type">g</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-197"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067105"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-198"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#chiSquare"><span class="hs-pragma hs-type">chiSquare</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-199"></span><span id="chiSquare"><span class="annot"><span class="annottext">chiSquare :: forall g (m :: * -&gt; *). StatefulGen g m =&gt; Int -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#chiSquare"><span class="hs-identifier hs-var hs-var">chiSquare</span></a></span></span><span> </span><span id="local-6989586621679067569"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067569"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679067570"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067570"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067569"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Double
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;chiSquare&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;number of degrees of freedom must be positive&quot;</span></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679067571"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067571"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; g -&gt; m Double
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067569"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067570"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-202"></span><span>                   </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067571"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Random variate generator for the geometric distribution,</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- computing the number of failures before success. Distribution's</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- support is [0..].</span><span>
</span><span id="line-207"></span><span id="local-6989586621679067108"><span id="local-6989586621679067109"><span class="annot"><a href="System.Random.MWC.Distributions.html#geometric0"><span class="hs-identifier hs-type">geometric0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067108"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067109"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-208"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ /p/ success probability lies in (0,1]</span></span><span>
</span><span id="line-209"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067108"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-210"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067109"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-211"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#geometric0"><span class="hs-pragma hs-type">geometric0</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-212"></span><span id="geometric0"><span class="annot"><span class="annottext">geometric0 :: forall g (m :: * -&gt; *). StatefulGen g m =&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#geometric0"><span class="hs-identifier hs-var hs-var">geometric0</span></a></span></span><span> </span><span id="local-6989586621679067594"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067594"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679067595"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067595"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067594"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067594"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span>  </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067594"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679067596"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067596"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067595"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-215"></span><span>                         </span><span class="hs-comment">-- FIXME: We want to use log1p here but it will</span><span>
</span><span id="line-216"></span><span>                         </span><span class="hs-comment">--        introduce dependency on math-functions.</span><span>
</span><span id="line-217"></span><span>                         </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m Int) -&gt; Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Double -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067596"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067594"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;geometric0&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;probability out of [0,1] range&quot;</span></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- | Random variate generator for geometric distribution for number of</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- trials. Distribution's support is [1..] (i.e. just 'geometric0'</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- shifted by 1).</span><span>
</span><span id="line-223"></span><span id="local-6989586621679067598"><span id="local-6989586621679067599"><span class="annot"><a href="System.Random.MWC.Distributions.html#geometric1"><span class="hs-identifier hs-type">geometric1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067598"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067599"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-224"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ /p/ success probability lies in (0,1]</span></span><span>
</span><span id="line-225"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067598"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-226"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067599"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-227"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#geometric1"><span class="hs-pragma hs-type">geometric1</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-228"></span><span id="geometric1"><span class="annot"><span class="annottext">geometric1 :: forall g (m :: * -&gt; *). StatefulGen g m =&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#geometric1"><span class="hs-identifier hs-var hs-var">geometric1</span></a></span></span><span> </span><span id="local-6989586621679067607"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067607"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679067608"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067608"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679067609"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067609"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; g -&gt; m Int
forall g (m :: * -&gt; *). StatefulGen g m =&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#geometric0"><span class="hs-identifier hs-var">geometric0</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067607"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067608"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-229"></span><span>                      </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m Int) -&gt; Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067609"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><span class="hs-comment">-- | Random variate generator for Beta distribution</span></span><span>
</span><span id="line-232"></span><span id="local-6989586621679067610"><span id="local-6989586621679067611"><span class="annot"><a href="System.Random.MWC.Distributions.html#beta"><span class="hs-identifier hs-type">beta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067610"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067611"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-233"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ alpha (&gt;0)</span></span><span>
</span><span id="line-234"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ beta  (&gt;0)</span></span><span>
</span><span id="line-235"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067610"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-236"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067611"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span></span></span><span>
</span><span id="line-237"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#beta"><span class="hs-pragma hs-type">beta</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-238"></span><span id="beta"><span class="annot"><span class="annottext">beta :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#beta"><span class="hs-identifier hs-var hs-var">beta</span></a></span></span><span> </span><span id="local-6989586621679067621"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067621"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679067622"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067622"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679067623"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067623"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679067624"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067624"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; g -&gt; m Double
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067621"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067623"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679067625"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067625"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; g -&gt; m Double
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067622"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067623"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">Double -&gt; m Double
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; Double -&gt; m Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067624"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067624"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067625"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><span class="hs-comment">-- | Random variate generator for Dirichlet distribution</span></span><span>
</span><span id="line-244"></span><span id="local-6989586621679067118"><span id="local-6989586621679067119"><span id="local-6989586621679067120"><span class="annot"><a href="System.Random.MWC.Distributions.html#dirichlet"><span class="hs-identifier hs-type">dirichlet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067118"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067119"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621679067120"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067120"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ container of parameters</span></span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067118"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067119"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067120"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-248"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#dirichlet"><span class="hs-pragma hs-type">dirichlet</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-249"></span><span id="dirichlet"><span class="annot"><span class="annottext">dirichlet :: forall g (m :: * -&gt; *) (t :: * -&gt; *).
(StatefulGen g m, Traversable t) =&gt;
t Double -&gt; g -&gt; m (t Double)
</span><a href="System.Random.MWC.Distributions.html#dirichlet"><span class="hs-identifier hs-var hs-var">dirichlet</span></a></span></span><span> </span><span id="local-6989586621679067643"><span class="annot"><span class="annottext">t Double
</span><a href="#local-6989586621679067643"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679067644"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067644"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621679067645"><span class="annot"><span class="annottext">t Double
</span><a href="#local-6989586621679067645"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; m Double) -&gt; t Double -&gt; m (t Double)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679067646"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067646"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; g -&gt; m Double
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Double -&gt; Double -&gt; g -&gt; m Double
</span><a href="System.Random.MWC.Distributions.html#gamma"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067646"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067644"><span class="hs-identifier hs-var">gen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t Double
</span><a href="#local-6989586621679067643"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067647"><span class="annot"><span class="annottext">total :: Double
</span><a href="#local-6989586621679067647"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; Double -&gt; t Double -&gt; Double
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">t Double
</span><a href="#local-6989586621679067645"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">t Double -&gt; m (t Double)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(t Double -&gt; m (t Double)) -&gt; t Double -&gt; m (t Double)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; t Double -&gt; t Double
forall a b. (a -&gt; b) -&gt; t a -&gt; t b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067647"><span class="hs-identifier hs-var">total</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t Double
</span><a href="#local-6989586621679067645"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><span class="hs-comment">-- | Random variate generator for Bernoulli distribution</span></span><span>
</span><span id="line-255"></span><span id="local-6989586621679067134"><span id="local-6989586621679067135"><span class="annot"><a href="System.Random.MWC.Distributions.html#bernoulli"><span class="hs-identifier hs-type">bernoulli</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067134"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067135"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Probability of success (returning True)</span></span><span>
</span><span id="line-257"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067134"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067135"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-259"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#bernoulli"><span class="hs-pragma hs-type">bernoulli</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-260"></span><span id="bernoulli"><span class="annot"><span class="annottext">bernoulli :: forall g (m :: * -&gt; *). StatefulGen g m =&gt; Double -&gt; g -&gt; m Bool
</span><a href="System.Random.MWC.Distributions.html#bernoulli"><span class="hs-identifier hs-var hs-var">bernoulli</span></a></span></span><span> </span><span id="local-6989586621679067653"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067653"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679067654"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067654"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067653"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; m Double -&gt; m Bool
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067654"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Random variate generator for categorical distribution.</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">--   Note that if you need to generate a lot of variates functions</span><span>
</span><span id="line-265"></span><span class="hs-comment">--   &quot;System.Random.MWC.CondensedTable&quot; will offer better</span><span>
</span><span id="line-266"></span><span class="hs-comment">--   performance.  If only few is needed this function will faster</span><span>
</span><span id="line-267"></span><span class="hs-comment">--   since it avoids costs of setting up table.</span><span>
</span><span id="line-268"></span><span id="local-6989586621679067138"><span id="local-6989586621679067139"><span id="local-6989586621679067140"><span class="annot"><a href="System.Random.MWC.Distributions.html#categorical"><span class="hs-identifier hs-type">categorical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067138"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067139"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679067140"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067140"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ List of weights [&gt;0]</span></span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067138"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067139"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-272"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#categorical"><span class="hs-pragma hs-type">categorical</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-273"></span><span id="categorical"><span class="annot"><span class="annottext">categorical :: forall g (m :: * -&gt; *) (v :: * -&gt; *).
(StatefulGen g m, Vector v Double) =&gt;
v Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#categorical"><span class="hs-identifier hs-var hs-var">categorical</span></a></span></span><span> </span><span id="local-6989586621679067669"><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067669"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679067670"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067670"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">v Double -&gt; Bool
forall (v :: * -&gt; *) a. Vector v a =&gt; v a -&gt; Bool
</span><span class="hs-identifier hs-var">G.null</span></span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067669"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;categorical&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty weights!&quot;</span></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067672"><span class="annot"><span class="annottext">cv :: v Double
</span><a href="#local-6989586621679067672"><span class="hs-identifier hs-var hs-var">cv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double -&gt; Double) -&gt; v Double -&gt; v Double
forall (v :: * -&gt; *) a. Vector v a =&gt; (a -&gt; a -&gt; a) -&gt; v a -&gt; v a
</span><span class="hs-identifier hs-var">G.scanl1'</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067669"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span id="local-6989586621679067674"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067674"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v Double -&gt; Double
forall (v :: * -&gt; *) a. Vector v a =&gt; v a -&gt; a
</span><span class="hs-identifier hs-var">G.last</span></span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067672"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; m Double -&gt; m Double
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067670"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m Int) -&gt; Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; v Double -&gt; Maybe Int
forall (v :: * -&gt; *) a.
Vector v a =&gt;
(a -&gt; Bool) -&gt; v a -&gt; Maybe Int
</span><span class="hs-identifier hs-var">G.findIndex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067674"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067672"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-279"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679067677"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067677"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067677"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-280"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;categorical&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad weights!&quot;</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Random variate generator for categorical distribution where the</span><span>
</span><span id="line-283"></span><span class="hs-comment">--   weights are in the log domain. It's implemented in terms of</span><span>
</span><span id="line-284"></span><span class="hs-comment">--   'categorical'.</span><span>
</span><span id="line-285"></span><span id="local-6989586621679067678"><span id="local-6989586621679067679"><span id="local-6989586621679067680"><span class="annot"><a href="System.Random.MWC.Distributions.html#logCategorical"><span class="hs-identifier hs-type">logCategorical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067678"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067679"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679067680"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067680"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ List of logarithms of weights</span></span><span>
</span><span id="line-287"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067678"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-288"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067679"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-289"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#logCategorical"><span class="hs-pragma hs-type">logCategorical</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-290"></span><span id="logCategorical"><span class="annot"><span class="annottext">logCategorical :: forall g (m :: * -&gt; *) (v :: * -&gt; *).
(StatefulGen g m, Vector v Double) =&gt;
v Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#logCategorical"><span class="hs-identifier hs-var hs-var">logCategorical</span></a></span></span><span> </span><span id="local-6989586621679067692"><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067692"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679067693"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067693"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">v Double -&gt; Bool
forall (v :: * -&gt; *) a. Vector v a =&gt; v a -&gt; Bool
</span><span class="hs-identifier hs-var">G.null</span></span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067692"><span class="hs-identifier hs-var">v</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;logCategorical&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty weights!&quot;</span></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v Double -&gt; g -&gt; m Int
forall g (m :: * -&gt; *) (v :: * -&gt; *).
(StatefulGen g m, Vector v Double) =&gt;
v Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#categorical"><span class="hs-identifier hs-var">categorical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; v Double -&gt; v Double
forall (v :: * -&gt; *) a b.
(Vector v a, Vector v b) =&gt;
(a -&gt; b) -&gt; v a -&gt; v b
</span><span class="hs-identifier hs-var">G.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Double -&gt; Double) -&gt; Double -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067695"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067692"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067693"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621679067695"><span class="annot"><span class="annottext">m :: Double
</span><a href="#local-6989586621679067695"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v Double -&gt; Double
forall (v :: * -&gt; *) a. (Vector v a, Ord a) =&gt; v a -&gt; a
</span><span class="hs-identifier hs-var">G.maximum</span></span><span> </span><span class="annot"><span class="annottext">v Double
</span><a href="#local-6989586621679067692"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-comment">-- | Random variate generator for uniformly distributed permutations.</span><span>
</span><span id="line-297"></span><span class="hs-comment">--   It returns random permutation of vector /[0 .. n-1]/.</span><span>
</span><span id="line-298"></span><span class="hs-comment">--</span><span>
</span><span id="line-299"></span><span class="hs-comment">--   This is the Fisher-Yates shuffle</span><span>
</span><span id="line-300"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformPermutation"><span class="hs-identifier hs-type">uniformPermutation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679067161"><span class="annot"><a href="#local-6989586621679067161"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679067162"><span class="annot"><a href="#local-6989586621679067162"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679067164"><span class="annot"><a href="#local-6989586621679067164"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067161"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067162"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrimMonad</span></span><span> </span><span class="annot"><a href="#local-6989586621679067162"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679067164"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-302"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067161"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-303"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067162"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067164"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformPermutation"><span class="hs-pragma hs-type">uniformPermutation</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-305"></span><span id="uniformPermutation"><span class="annot"><span class="annottext">uniformPermutation :: forall g (m :: * -&gt; *) (v :: * -&gt; *).
(StatefulGen g m, PrimMonad m, Vector v Int) =&gt;
Int -&gt; g -&gt; m (v Int)
</span><a href="System.Random.MWC.Distributions.html#uniformPermutation"><span class="hs-identifier hs-var hs-var">uniformPermutation</span></a></span></span><span> </span><span id="local-6989586621679067706"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067706"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679067707"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067707"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067706"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m (v Int)
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uniformPermutation&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;size must be &gt;=0&quot;</span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v Int -&gt; g -&gt; m (v Int)
forall g (m :: * -&gt; *) (v :: * -&gt; *) a.
(StatefulGen g m, PrimMonad m, Vector v a) =&gt;
v a -&gt; g -&gt; m (v a)
</span><a href="System.Random.MWC.Distributions.html#uniformShuffle"><span class="hs-identifier hs-var">uniformShuffle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Int) -&gt; v Int
forall (v :: * -&gt; *) a. Vector v a =&gt; Int -&gt; (Int -&gt; a) -&gt; v a
</span><span class="hs-identifier hs-var">G.generate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067706"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067164"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067707"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">-- | Random variate generator for a uniformly distributed shuffle (all</span><span>
</span><span id="line-310"></span><span class="hs-comment">--   shuffles are equiprobable) of a vector. It uses Fisher-Yates</span><span>
</span><span id="line-311"></span><span class="hs-comment">--   shuffle algorithm.</span><span>
</span><span id="line-312"></span><span id="local-6989586621679067168"><span id="local-6989586621679067169"><span id="local-6989586621679067170"><span id="local-6989586621679067171"><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformShuffle"><span class="hs-identifier hs-type">uniformShuffle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067168"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067169"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrimMonad</span></span><span> </span><span class="annot"><a href="#local-6989586621679067169"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">G.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679067170"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067170"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067171"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-314"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067168"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-315"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067169"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067170"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067171"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-316"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformShuffle"><span class="hs-pragma hs-type">uniformShuffle</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-317"></span><span id="uniformShuffle"><span class="annot"><span class="annottext">uniformShuffle :: forall g (m :: * -&gt; *) (v :: * -&gt; *) a.
(StatefulGen g m, PrimMonad m, Vector v a) =&gt;
v a -&gt; g -&gt; m (v a)
</span><a href="System.Random.MWC.Distributions.html#uniformShuffle"><span class="hs-identifier hs-var hs-var">uniformShuffle</span></a></span></span><span> </span><span id="local-6989586621679067729"><span class="annot"><span class="annottext">v a
</span><a href="#local-6989586621679067729"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span id="local-6989586621679067730"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067730"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">v a -&gt; Int
forall (v :: * -&gt; *) a. Vector v a =&gt; v a -&gt; Int
</span><span class="hs-identifier hs-var">G.length</span></span><span> </span><span class="annot"><span class="annottext">v a
</span><a href="#local-6989586621679067729"><span class="hs-identifier hs-var">vec</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v a -&gt; m (v a)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">v a
</span><a href="#local-6989586621679067729"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>      </span><span id="local-6989586621679067732"><span class="annot"><span class="annottext">Mutable v (PrimState m) a
</span><a href="#local-6989586621679067732"><span class="hs-identifier hs-var">mvec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">v a -&gt; m (Mutable v (PrimState m) a)
forall (m :: * -&gt; *) (v :: * -&gt; *) a.
(PrimMonad m, Vector v a) =&gt;
v a -&gt; m (Mutable v (PrimState m) a)
</span><span class="hs-identifier hs-var">G.thaw</span></span><span> </span><span class="annot"><span class="annottext">v a
</span><a href="#local-6989586621679067729"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">Mutable v (PrimState m) a -&gt; g -&gt; m ()
forall g (m :: * -&gt; *) (v :: * -&gt; * -&gt; *) a.
(StatefulGen g m, PrimMonad m, MVector v a) =&gt;
v (PrimState m) a -&gt; g -&gt; m ()
</span><a href="System.Random.MWC.Distributions.html#uniformShuffleM"><span class="hs-identifier hs-var">uniformShuffleM</span></a></span><span> </span><span class="annot"><span class="annottext">Mutable v (PrimState m) a
</span><a href="#local-6989586621679067732"><span class="hs-identifier hs-var">mvec</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067730"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-322"></span><span>      </span><span class="annot"><span class="annottext">Mutable v (PrimState m) a -&gt; m (v a)
forall (m :: * -&gt; *) (v :: * -&gt; *) a.
(PrimMonad m, Vector v a) =&gt;
Mutable v (PrimState m) a -&gt; m (v a)
</span><span class="hs-identifier hs-var">G.unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">Mutable v (PrimState m) a
</span><a href="#local-6989586621679067732"><span class="hs-identifier hs-var">mvec</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-comment">-- | In-place uniformly distributed shuffle (all shuffles are</span><span>
</span><span id="line-325"></span><span class="hs-comment">--   equiprobable)of a vector.</span><span>
</span><span id="line-326"></span><span id="local-6989586621679067189"><span id="local-6989586621679067190"><span id="local-6989586621679067191"><span id="local-6989586621679067192"><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformShuffleM"><span class="hs-identifier hs-type">uniformShuffleM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067189"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067190"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrimMonad</span></span><span> </span><span class="annot"><a href="#local-6989586621679067190"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.MVector</span></span><span> </span><span class="annot"><a href="#local-6989586621679067191"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067192"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067191"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><a href="#local-6989586621679067190"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679067192"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-328"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067189"><span class="hs-identifier hs-type">g</span></a></span><span>
</span><span id="line-329"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067190"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-330"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#uniformShuffleM"><span class="hs-pragma hs-type">uniformShuffleM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-331"></span><span id="uniformShuffleM"><span class="annot"><span class="annottext">uniformShuffleM :: forall g (m :: * -&gt; *) (v :: * -&gt; * -&gt; *) a.
(StatefulGen g m, PrimMonad m, MVector v a) =&gt;
v (PrimState m) a -&gt; g -&gt; m ()
</span><a href="System.Random.MWC.Distributions.html#uniformShuffleM"><span class="hs-identifier hs-var hs-var">uniformShuffleM</span></a></span></span><span> </span><span id="local-6989586621679067758"><span class="annot"><span class="annottext">v (PrimState m) a
</span><a href="#local-6989586621679067758"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span id="local-6989586621679067759"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067759"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">v (PrimState m) a -&gt; Int
forall (v :: * -&gt; * -&gt; *) a s. MVector v a =&gt; v s a -&gt; Int
</span><span class="hs-identifier hs-var">M.length</span></span><span> </span><span class="annot"><span class="annottext">v (PrimState m) a
</span><a href="#local-6989586621679067758"><span class="hs-identifier hs-var">vec</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679067761"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621679067762"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679067762"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v (PrimState m) a -&gt; Int
forall (v :: * -&gt; * -&gt; *) a s. MVector v a =&gt; v s a -&gt; Int
</span><span class="hs-identifier hs-var">M.length</span></span><span> </span><span class="annot"><span class="annottext">v (PrimState m) a
</span><a href="#local-6989586621679067758"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621679067763"><span class="annot"><span class="annottext">lst :: Int
</span><a href="#local-6989586621679067763"><span class="hs-identifier hs-var hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067762"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621679067761"><span class="annot"><span class="annottext">loop :: Int -&gt; m ()
</span><a href="#local-6989586621679067761"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679067764"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067764"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067764"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067763"><span class="hs-identifier hs-var">lst</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679067765"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067765"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; g -&gt; m Int
forall a g (m :: * -&gt; *).
(UniformRange a, StatefulGen g m) =&gt;
(a, a) -&gt; g -&gt; m a
forall g (m :: * -&gt; *). StatefulGen g m =&gt; (Int, Int) -&gt; g -&gt; m Int
</span><span class="hs-identifier hs-var">uniformRM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067764"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067763"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067759"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-339"></span><span>                            </span><span class="annot"><span class="annottext">v (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
forall (m :: * -&gt; *) (v :: * -&gt; * -&gt; *) a.
(PrimMonad m, MVector v a) =&gt;
v (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
</span><span class="hs-identifier hs-var">M.unsafeSwap</span></span><span> </span><span class="annot"><span class="annottext">v (PrimState m) a
</span><a href="#local-6989586621679067758"><span class="hs-identifier hs-var">vec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067764"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067765"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-340"></span><span>                            </span><span class="annot"><span class="annottext">Int -&gt; m ()
</span><a href="#local-6989586621679067761"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067764"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#sqr"><span class="hs-identifier hs-type">sqr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-344"></span><span id="sqr"><span class="annot"><span class="annottext">sqr :: Double -&gt; Double
</span><a href="System.Random.MWC.Distributions.html#sqr"><span class="hs-identifier hs-var hs-var">sqr</span></a></span></span><span> </span><span id="local-6989586621679067768"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067768"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067768"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067768"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-345"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#sqr"><span class="hs-pragma hs-type">sqr</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span id="local-6989586621679067103"><span class="annot"><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-type">pkgError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067103"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-348"></span><span id="pkgError"><span class="annot"><span class="annottext">pkgError :: forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var hs-var">pkgError</span></a></span></span><span> </span><span id="local-6989586621679067771"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679067771"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span id="local-6989586621679067772"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679067772"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;System.Random.MWC.Distributions.&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679067771"><span class="hs-identifier hs-var">func</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-349"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679067772"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- | Random variate generator for Binomial distribution. Will throw</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- exception when parameters are out range.</span><span>
</span><span id="line-353"></span><span class="hs-comment">--</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- The probability of getting exactly k successes in n trials is</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- given by the probability mass function:</span><span>
</span><span id="line-356"></span><span class="hs-comment">--</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- \[</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- f(k;n,p) = \Pr(X = k) = \binom n k  p^k(1-p)^{n-k}</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- \]</span><span>
</span><span id="line-360"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#binomial"><span class="hs-identifier hs-type">binomial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679067215"><span class="annot"><a href="#local-6989586621679067215"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679067216"><span class="annot"><a href="#local-6989586621679067216"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067215"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067216"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-361"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Number of trials, must be positive.</span></span><span>
</span><span id="line-362"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Probability of success \(p \in [0,1]\)</span></span><span>
</span><span id="line-363"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067215"><span class="hs-identifier hs-type">g</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Generator</span></span><span>
</span><span id="line-364"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067216"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-365"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#binomial"><span class="hs-pragma hs-type">binomial</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-366"></span><span id="binomial"><span class="annot"><span class="annottext">binomial :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomial"><span class="hs-identifier hs-var hs-var">binomial</span></a></span></span><span> </span><span id="local-6989586621679067812"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679067813"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679067814"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067814"><span class="hs-identifier hs-var">gen</span></a></span></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;binomial&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;number of trials must be positive&quot;</span></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;binomial&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;probability must be &gt;= 0 and &lt;= 1&quot;</span></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span>
</span><span id="line-372"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067816"><span class="hs-identifier hs-var">inv_thr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; g -&gt; m Int
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomialInv"><span class="hs-identifier hs-var">binomialInv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067814"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; g -&gt; m Int
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomialTPE"><span class="hs-identifier hs-var">binomialTPE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067814"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-375"></span><span>      </span><span id="local-6989586621679067819"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067819"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067813"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-376"></span><span>        </span><span id="local-6989586621679067820"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067820"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067820"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067816"><span class="hs-identifier hs-var">inv_thr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; g -&gt; m Int
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomialInv"><span class="hs-identifier hs-var">binomialInv</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067820"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067814"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-377"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; g -&gt; m Int
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomialTPE"><span class="hs-identifier hs-var">binomialTPE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067820"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067814"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m Int) -&gt; Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067812"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067819"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-comment">-- Reachable when p is NaN</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; m Int
forall a. String -&gt; String -&gt; a
</span><a href="System.Random.MWC.Distributions.html#pkgError"><span class="hs-identifier hs-var">pkgError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;binomial&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;probability must be &gt;= 0 and &lt;= 1&quot;</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">-- Threshold for preferring the BINV algorithm / inverse cdf</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-comment">-- logic. The paper suggests 10, Ranlib uses 30, R uses 30, Rust uses</span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-comment">-- 10 and GSL uses 14.</span><span>
</span><span id="line-385"></span><span>    </span><span id="local-6989586621679067816"><span class="annot"><span class="annottext">inv_thr :: Double
</span><a href="#local-6989586621679067816"><span class="hs-identifier hs-var hs-var">inv_thr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Binomial-Triangle-Parallelogram-Exponential algorithm (BTPE)</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- described in Kachitvichyanukul1988</span><span>
</span><span id="line-389"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#binomialTPE"><span class="hs-identifier hs-type">binomialTPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679067822"><span class="annot"><a href="#local-6989586621679067822"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679067823"><span class="annot"><a href="#local-6989586621679067823"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067822"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067823"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067822"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067823"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-390"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#binomialTPE"><span class="hs-pragma hs-type">binomialTPE</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-391"></span><span id="binomialTPE"><span class="annot"><span class="annottext">binomialTPE :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomialTPE"><span class="hs-identifier hs-var hs-var">binomialTPE</span></a></span></span><span> </span><span id="local-6989586621679067956"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067956"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679067957"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067957"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679067958"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067958"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Int
</span><a href="#local-6989586621679067959"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-comment">-- Main accept/reject loop</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621679067959"><span class="annot"><span class="annottext">loop :: m Int
</span><a href="#local-6989586621679067959"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>      </span><span id="local-6989586621679067960"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067960"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; g -&gt; m Double
forall a g (m :: * -&gt; *).
(UniformRange a, StatefulGen g m) =&gt;
(a, a) -&gt; g -&gt; m a
forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
(Double, Double) -&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformRM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067961"><span class="hs-identifier hs-var">p4</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067958"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-396"></span><span>      </span><span id="local-6989586621679067962"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067962"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679067958"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-397"></span><span>      </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; m Int
</span><a href="#local-6989586621679067963"><span class="hs-identifier hs-var">selectArea</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067960"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067962"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">-- Acceptance / rejection of sample [step 5]</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="#local-6989586621679067964"><span class="hs-identifier hs-type">acceptReject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067823"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621679067964"><span class="annot"><span class="annottext">acceptReject :: Int -&gt; Double -&gt; m Int
</span><a href="#local-6989586621679067964"><span class="hs-identifier hs-var hs-var">acceptReject</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679067965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067965"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679067966"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067966"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067967"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067968"><span class="hs-identifier hs-var">accept</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067965"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Int
</span><a href="#local-6989586621679067959"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-404"></span><span>        </span><span id="local-6989586621679067967"><span class="annot"><span class="annottext">var :: Double
</span><a href="#local-6989586621679067967"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067966"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-405"></span><span>        </span><span id="local-6989586621679067968"><span class="annot"><span class="annottext">accept :: Double
</span><a href="#local-6989586621679067968"><span class="hs-identifier hs-var hs-var">accept</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a. Integral a =&gt; a -&gt; Double
</span><span class="hs-identifier hs-var">logFactorial</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067969"><span class="hs-identifier hs-var">bigM</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a. Integral a =&gt; a -&gt; Double
</span><span class="hs-identifier hs-var">logFactorial</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067956"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067969"><span class="hs-identifier hs-var">bigM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span>
</span><span id="line-406"></span><span>                 </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a. Integral a =&gt; a -&gt; Double
</span><span class="hs-identifier hs-var">logFactorial</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067965"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a. Integral a =&gt; a -&gt; Double
</span><span class="hs-identifier hs-var">logFactorial</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067956"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067965"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span>
</span><span id="line-407"></span><span>                 </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067965"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067969"><span class="hs-identifier hs-var">bigM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067957"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067970"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- Select area to be used [Steps 1-4]</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="#local-6989586621679067963"><span class="hs-identifier hs-type">selectArea</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067823"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679067963"><span class="annot"><span class="annottext">selectArea :: Double -&gt; Double -&gt; m Int
</span><a href="#local-6989586621679067963"><span class="hs-identifier hs-var hs-var">selectArea</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679067971"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679067972"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-comment">-- Triangular region</span><span>
</span><span id="line-412"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m Int) -&gt; Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Double -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067974"><span class="hs-identifier hs-var">xm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-comment">-- Parallelogram region</span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067975"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067976"><span class="annot"><span class="annottext">x :: Double
</span><a href="#local-6989586621679067976"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067977"><span class="hs-identifier hs-var">xl</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-415"></span><span>                         </span><span id="local-6989586621679067979"><span class="annot"><span class="annottext">w :: Double
</span><a href="#local-6989586621679067979"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067976"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067974"><span class="hs-identifier hs-var">xm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-416"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067979"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067979"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-417"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m Int
</span><a href="#local-6989586621679067959"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-418"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067980"><span class="annot"><span class="annottext">ix :: Int
</span><a href="#local-6989586621679067980"><span class="hs-identifier hs-var hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067976"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-419"></span><span>                               </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; m Int
</span><a href="#local-6989586621679067964"><span class="hs-identifier hs-var">acceptReject</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067980"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067979"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-comment">-- Left tail</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067981"><span class="hs-identifier hs-var">p3</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Double -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067977"><span class="hs-identifier hs-var">xl</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067982"><span class="hs-identifier hs-var">lambdaL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span>          </span><span id="local-6989586621679067983"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067983"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067983"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Int
</span><a href="#local-6989586621679067959"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-423"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067984"><span class="annot"><span class="annottext">w :: Double
</span><a href="#local-6989586621679067984"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067975"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067982"><span class="hs-identifier hs-var">lambdaL</span></a></span><span>
</span><span id="line-424"></span><span>                               </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; m Int
</span><a href="#local-6989586621679067964"><span class="hs-identifier hs-var">acceptReject</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067983"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067984"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-comment">-- Right tail</span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Int) -&gt; Double -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067985"><span class="hs-identifier hs-var">xr</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">log</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067986"><span class="hs-identifier hs-var">lambdaR</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-427"></span><span>          </span><span id="local-6989586621679067987"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067987"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067987"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067956"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Int
</span><a href="#local-6989586621679067959"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-428"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067988"><span class="annot"><span class="annottext">w :: Double
</span><a href="#local-6989586621679067988"><span class="hs-identifier hs-var hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067972"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067971"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067981"><span class="hs-identifier hs-var">p3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067986"><span class="hs-identifier hs-var">lambdaR</span></a></span><span>
</span><span id="line-429"></span><span>                               </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; m Int
</span><a href="#local-6989586621679067964"><span class="hs-identifier hs-var">acceptReject</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067987"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067988"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-comment">----------------------------------------</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- Constants used in algorithm. See [Step 0]</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621679067970"><span class="annot"><span class="annottext">q :: Double
</span><a href="#local-6989586621679067970"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067957"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679067989"><span class="annot"><span class="annottext">np :: Double
</span><a href="#local-6989586621679067989"><span class="hs-identifier hs-var hs-var">np</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067956"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067957"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621679067990"><span class="annot"><span class="annottext">ffm :: Double
</span><a href="#local-6989586621679067990"><span class="hs-identifier hs-var hs-var">ffm</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067989"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067957"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621679067969"><span class="annot"><span class="annottext">bigM :: Int
</span><a href="#local-6989586621679067969"><span class="hs-identifier hs-var hs-var">bigM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067990"><span class="hs-identifier hs-var">ffm</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-comment">-- Half integer mean (tip of triangle)</span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621679067974"><span class="annot"><span class="annottext">xm :: Double
</span><a href="#local-6989586621679067974"><span class="hs-identifier hs-var hs-var">xm</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067969"><span class="hs-identifier hs-var">bigM</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- p1: the distance to the left and right edges of the triangle</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- region below the target distribution; since height=1, also:</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-comment">-- area of region (half base * height)</span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679067973"><span class="annot"><span class="annottext">p1 :: Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067991"><span class="annot"><span class="annottext">npq :: Double
</span><a href="#local-6989586621679067991"><span class="hs-identifier hs-var hs-var">npq</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067989"><span class="hs-identifier hs-var">np</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067970"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-442"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Int
forall b. Integral b =&gt; Double -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">floor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.195</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067991"><span class="hs-identifier hs-var">npq</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">4.6</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067970"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621679067977"><span class="annot"><span class="annottext">xl :: Double
</span><a href="#local-6989586621679067977"><span class="hs-identifier hs-var hs-var">xl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067974"><span class="hs-identifier hs-var">xm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span>   </span><span class="hs-comment">-- Left edge of triangle</span><span>
</span><span id="line-444"></span><span>    </span><span id="local-6989586621679067985"><span class="annot"><span class="annottext">xr :: Double
</span><a href="#local-6989586621679067985"><span class="hs-identifier hs-var hs-var">xr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067974"><span class="hs-identifier hs-var">xm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span>   </span><span class="hs-comment">-- Right edge of triangle</span><span>
</span><span id="line-445"></span><span>    </span><span id="local-6989586621679067978"><span class="annot"><span class="annottext">c :: Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.134</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">20.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">15.3</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679067969"><span class="hs-identifier hs-var">bigM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-comment">-- p1 + area of parallelogram region</span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679067975"><span class="annot"><span class="annottext">p2 :: Double
</span><a href="#local-6989586621679067975"><span class="hs-identifier hs-var hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067973"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621679067982"><span class="annot"><span class="annottext">lambdaL :: Double
</span><a href="#local-6989586621679067982"><span class="hs-identifier hs-var hs-var">lambdaL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067992"><span class="annot"><span class="annottext">al :: Double
</span><a href="#local-6989586621679067992"><span class="hs-identifier hs-var hs-var">al</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067990"><span class="hs-identifier hs-var">ffm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067977"><span class="hs-identifier hs-var">xl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067990"><span class="hs-identifier hs-var">ffm</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067977"><span class="hs-identifier hs-var">xl</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067957"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067992"><span class="hs-identifier hs-var">al</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067992"><span class="hs-identifier hs-var">al</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>    </span><span id="local-6989586621679067986"><span class="annot"><span class="annottext">lambdaR :: Double
</span><a href="#local-6989586621679067986"><span class="hs-identifier hs-var hs-var">lambdaR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679067993"><span class="annot"><span class="annottext">ar :: Double
</span><a href="#local-6989586621679067993"><span class="hs-identifier hs-var hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067985"><span class="hs-identifier hs-var">xr</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067990"><span class="hs-identifier hs-var">ffm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067985"><span class="hs-identifier hs-var">xr</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067970"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067993"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.5</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067993"><span class="hs-identifier hs-var">ar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-comment">-- p2 + area of left tail</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679067981"><span class="annot"><span class="annottext">p3 :: Double
</span><a href="#local-6989586621679067981"><span class="hs-identifier hs-var hs-var">p3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067975"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067982"><span class="hs-identifier hs-var">lambdaL</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-comment">-- p3 + area of right tail</span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679067961"><span class="annot"><span class="annottext">p4 :: Double
</span><a href="#local-6989586621679067961"><span class="hs-identifier hs-var hs-var">p4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067981"><span class="hs-identifier hs-var">p3</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067978"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679067986"><span class="hs-identifier hs-var">lambdaR</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="hs-comment">-- Compute binomial variate using inversion method (BINV in</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- Kachitvichyanukul1988)</span><span>
</span><span id="line-461"></span><span id="local-6989586621679067994"><span id="local-6989586621679067995"><span class="annot"><a href="System.Random.MWC.Distributions.html#binomialInv"><span class="hs-identifier hs-type">binomialInv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StatefulGen</span></span><span> </span><span class="annot"><a href="#local-6989586621679067994"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067994"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-462"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="System.Random.MWC.Distributions.html#binomialInv"><span class="hs-pragma hs-type">binomialInv</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-463"></span><span id="binomialInv"><span class="annot"><span class="annottext">binomialInv :: forall g (m :: * -&gt; *).
StatefulGen g m =&gt;
Int -&gt; Double -&gt; g -&gt; m Int
</span><a href="System.Random.MWC.Distributions.html#binomialInv"><span class="hs-identifier hs-var hs-var">binomialInv</span></a></span></span><span> </span><span id="local-6989586621679068001"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068001"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679068002"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068002"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679068003"><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679068003"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>  </span><span id="local-6989586621679068004"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068004"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">g -&gt; m Double
forall g (m :: * -&gt; *). StatefulGen g m =&gt; g -&gt; m Double
</span><span class="hs-identifier hs-var">uniformDoublePositive01M</span></span><span> </span><span class="annot"><span class="annottext">g
</span><a href="#local-6989586621679068003"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m Int) -&gt; Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double -&gt; Double -&gt; Int
</span><a href="System.Random.MWC.Distributions.html#invertBinomial"><span class="hs-identifier hs-var">invertBinomial</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068001"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068002"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068004"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-comment">-- This function is defined on top level to avoid inlining it since it's rather</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- large and we don't need specializations since it's monomorphic anyway</span><span>
</span><span id="line-469"></span><span class="annot"><a href="System.Random.MWC.Distributions.html#invertBinomial"><span class="hs-identifier hs-type">invertBinomial</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="hs-comment">-- N of trials</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-comment">-- probability of success</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-comment">-- Output of PRNG</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-474"></span><span id="invertBinomial"><span class="annot"><span class="annottext">invertBinomial :: Int -&gt; Double -&gt; Double -&gt; Int
</span><a href="System.Random.MWC.Distributions.html#invertBinomial"><span class="hs-identifier hs-var hs-var">invertBinomial</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679068006"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068006"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679068007"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068007"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679068008"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068008"><span class="hs-identifier hs-var">u0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Int -&gt; Int
</span><a href="#local-6989586621679068009"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068010"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068006"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068008"><span class="hs-identifier hs-var">u0</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-comment">-- We forcing s&amp;a in order to avoid allocating thunks. Those are</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-comment">-- more expensive than computing them unconditionally</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621679068010"><span class="annot"><span class="annottext">q :: Double
</span><a href="#local-6989586621679068010"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068007"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679068012"><span class="annot"><span class="annottext">s :: Double
</span><a href="#local-6989586621679068012"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068007"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068010"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679068013"><span class="annot"><span class="annottext">a :: Double
</span><a href="#local-6989586621679068013"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068006"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068012"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-482"></span><span>    </span><span id="local-6989586621679068009"><span class="annot"><span class="annottext">invert :: Double -&gt; Double -&gt; Int -&gt; Int
</span><a href="#local-6989586621679068009"><span class="hs-identifier hs-var hs-var">invert</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679068014"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068014"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679068015"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068015"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679068016"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068016"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068015"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068014"><span class="hs-identifier hs-var">r</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068016"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-484"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Int -&gt; Int
</span><a href="#local-6989586621679068009"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068017"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068018"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068019"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-486"></span><span>        </span><span id="local-6989586621679068018"><span class="annot"><span class="annottext">u' :: Double
</span><a href="#local-6989586621679068018"><span class="hs-identifier hs-var hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068015"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068014"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-487"></span><span>        </span><span id="local-6989586621679068019"><span class="annot"><span class="annottext">x' :: Int
</span><a href="#local-6989586621679068019"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068016"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-488"></span><span>        </span><span id="local-6989586621679068017"><span class="annot"><span class="annottext">r' :: Double
</span><a href="#local-6989586621679068017"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068014"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068013"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068019"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068012"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">-- $references</span><span>
</span><span id="line-492"></span><span class="hs-comment">--</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- * Doornik, J.A. (2005) An improved ziggurat method to generate</span><span>
</span><span id="line-494"></span><span class="hs-comment">--   normal random samples. Mimeo, Nuffield College, University of</span><span>
</span><span id="line-495"></span><span class="hs-comment">--   Oxford.  &lt;http://www.doornik.com/research/ziggurat.pdf&gt;</span><span>
</span><span id="line-496"></span><span class="hs-comment">--</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- * Thomas, D.B.; Leong, P.G.W.; Luk, W.; Villasenor, J.D.</span><span>
</span><span id="line-498"></span><span class="hs-comment">--   (2007). Gaussian random number generators.</span><span>
</span><span id="line-499"></span><span class="hs-comment">--   /ACM Computing Surveys/ 39(4).</span><span>
</span><span id="line-500"></span><span class="hs-comment">--   &lt;http://www.cse.cuhk.edu.hk/~phwl/mt/public/archives/papers/grng_acmcs07.pdf&gt;</span><span>
</span><span id="line-501"></span><span class="hs-comment">--</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- * Kachitvichyanukul, V. and Schmeiser, B. W.  Binomial Random</span><span>
</span><span id="line-503"></span><span class="hs-comment">--   Variate Generation.  Communications of the ACM, 31, 2 (February,</span><span>
</span><span id="line-504"></span><span class="hs-comment">--   1988) 216. &lt;https://dl.acm.org/doi/pdf/10.1145/42372.42381&gt;</span><span>
</span><span id="line-505"></span><span class="hs-comment">--   Here's an example of how the algorithm's sampling regions look</span><span>
</span><span id="line-506"></span><span class="hs-comment">--   ![Something](docs/RecreateFigure.svg)</span><span>
</span><span id="line-507"></span></pre></body></html>